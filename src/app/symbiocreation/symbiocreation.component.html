 <mat-sidenav-container autosize hasBackdrop="false" style="height: calc(100% - 64px)"> <!-- make this occupy total height - toolbar.height -->

     <!-- Analytics fixed button -->
    <!-- <div>
        <button mat-mini-fab color="accent" class="btn-stats"
                matTooltip="Ver Estadísticas de Simbiocreación"
                matTooltipPosition="above"
                (click)="sidenavAnalytics.open()">
            <mat-icon>bar_chart</mat-icon>
        </button>
    </div> -->

    <!--
    MARK: Side Analitycs
    -->
    <!-- <mat-sidenav #sidenavAnalytics position="start" class="sidebar-analitycs">
        <app-symbiocreations-stats [symbiocreationId]="symbiocreation?.id"></app-symbiocreations-stats>
    </mat-sidenav> -->

    <!--
    MARK: Side Detail
    -->
    <mat-sidenav #sidenav position="end" class="sidebar-idea-detail" [ngClass]="{ 'detailFullScreen':sidenavService.isOpenInFullscreen, 'detailCustom' : !sidenavService.isOpenInFullscreen}">
        <router-outlet></router-outlet>
    </mat-sidenav>

    <!--
    MARK: Side Listas
    -->
    <mat-sidenav #sidenavGroups position="start" class="sidebar-groups" [(opened)]="isSidenavGroupsOpen">

        <div class="header">
            <img src="assets/images/logo_symbio_2024.png" alt="">
            <span class="btn-close" (click)="sidenavGroups.close()"><mat-icon>close</mat-icon></span>
        </div>

        <div class="body">
            <div class="title" *ngIf="GroupParticipantStat==1">Grupos</div>
            <div class="title" *ngIf="GroupParticipantStat==2">Participantes</div>
            <div class="title" *ngIf="GroupParticipantStat==3">Top usuarios</div>
            <div class="title" *ngIf="GroupParticipantStat==4">Tendencias</div>
            <div class="title" *ngIf="GroupParticipantStat==5">Mi(s) idea(s)</div>

            <div class="container-lista group" *ngIf="GroupParticipantStat == 1">

                <div class="container-elemento" *ngFor="let g of filteredGroups; let i = index" (mouseenter)="onMouseEnterListItem([g])" (mouseleave)="onMouseLeaveListItem([g])">
                    <div class="data" style="display: flex; ">
                        <div class="data-index">{{i+1}}</div>
                        <div class="data-data">
                            <div class="data-name" (click)="openIdeaDetailSidenav(g)">{{g.name}}</div>
                            <div class="data-node">{{g.children.length}} {{g.children.length === 1 ? 'nodo' : 'nodos'}}</div>
                        </div>
                    </div>
                    <div class="buttons">

                        <button *ngIf="participant?.isModerator || isAmbassadorOfAnyGroupBelow(g)" mat-icon-button [matMenuTriggerFor]="groupMenu" [matMenuTriggerData]="{node: g}">
                            <mat-icon>more_vert</mat-icon>
                        </button>

                    </div>
                </div>

            </div>

            <div class="container-lista participant" *ngIf="GroupParticipantStat == 2">

                <div class="container-elemento" *ngFor="let p of filteredParticipants;let i = index" (mouseenter)="onMouseEnterListItem(getNodesByUserId(p.u_id))" (mouseleave)="onMouseLeaveListItem(getNodesByUserId(p.u_id))">

                    <div class="data" style="display: flex; ">
                        <div class="data-index">{{i+1}}</div>
                        <div class="data-data">
                            <div class="data-name" *ngIf="p.user.firstName && p.user.lastName" (click)="preOpenIdeaDetailSidenav(p.u_id)">{{p.user.firstName}} {{p.user.lastName}} <span *ngIf="p.isModerator" class="chip-role small moderator">Moderador</span></div>
                            <div class="data-name" *ngIf="!(p.user.firstName && p.user.lastName)" (click)="preOpenIdeaDetailSidenav(p.u_id)">{{p.user.name}} <span *ngIf="p.isModerator" class="chip-role small moderator">Moderador</span></div>
                            <div class="data-name" *ngIf="p.u_id === participant?.u_id" (click)="preOpenIdeaDetailSidenav(p.u_id)">
                                (tú)

                            </div>

                            <!-- <div class="data-node">PUNTAJE: 4</div> -->
                        </div>
                    </div>
                    <div class="buttons">

                        <button mat-icon-button
                        [matMenuTriggerFor]="participantMenu"
                        [matMenuTriggerData]="{participant: p}">
                            <mat-icon>more_vert</mat-icon>
                        </button>

                    </div>

                </div>

            </div>

            <div class="container-lista topUser" *ngIf="GroupParticipantStat == 3">

                <div class="container-elemento" *ngFor="let ur of usersRanking;let i = index">

                    <div class="data" style="display: flex; ">
                        <div class="data-index">{{i+1}}</div>
                        <div class="data-data">
                            <div class="data-name">{{ur?.user?.name}}</div>
                            <div class="data-node">PUNTAJE: {{ur?.score}}</div>
                        </div>
                    </div>
                    <div class="buttons">

                    </div>

                </div>

            </div>

            <div class="container-lista tendency" *ngIf="GroupParticipantStat == 4">

                <div class="container-elemento" *ngFor="let ctr of commonTermsRanking;let i = index">

                    <div class="data" style="display: flex; ">
                        <div class="data-index">{{i+1}}</div>
                        <div class="data-data">
                            <div class="data-name">{{ctr?.term}}</div>
                            <div class="data-node">PUNTAJE: {{ctr?.count}}</div>
                        </div>
                    </div>
                    <div class="buttons">

                    </div>

                </div>

            </div>

            <div class="container-lista list-idea" *ngIf="GroupParticipantStat == 5">

                <div *ngIf="participant">
                    <div fxLayout="column">
                        <div class="gray-900 bold" style="padding: 5px 10px; margin-right: 15px; width: 120px; text-align: left;">
                            <!-- Mi(s) idea(s) <br /> -->
                            <button mat-button
                                color="primary"
                                (click)="createUserNode()"
                                class="btn-symbio-add-group"
                                style="padding: 0;">
                                <mat-icon>add</mat-icon>
                                Nueva idea
                            </button>
                            <!--<span *ngIf="roleOfLoggedIn === 'ambassador'" class="chip-role small ambassador">Embajador</span>-->
                        </div>

                        <div fxFlex style="padding: 5px 10px 0;">
                            <div *ngFor="let lineage of myAncestries" class="item-ideas">

                                <button *ngIf="!lineage[0].idea"
                                    mat-flat-button
                                    color="accent"
                                    (click)="openMyIdeaEditDialog(lineage[0])"
                                    (mouseenter)="onMouseEnterListItem([lineage[0]])"
                                    (mouseleave)="onMouseLeaveListItem([lineage[0]])"
                                    class="btn-idea-element"
                                    >
                                    <span class="italicized">(vacío)</span>
                                </button>

                                <button *ngIf="lineage[0].idea"
                                    mat-flat-button
                                    color="accent"
                                    matTooltip="Ver detalle"
                                    (click)="openIdeaDetailSidenav(lineage[0])"
                                    (mouseenter)="onMouseEnterListItem([lineage[0]])"
                                    (mouseleave)="onMouseLeaveListItem([lineage[0]])"
                                    class="btn-idea-element"
                                    >
                                    <mat-icon>open_in_new</mat-icon>
                                    <span class="ellipsed" style="display: inline-block; width: 130px;">{{lineage[0].idea?.title}}</span>
                                </button>

                                <ng-container *ngFor="let node of lineage | slice:1; index as i; last as last">
                                    <span> &lt; </span>
                                    <span class="chip-ancestry">
                                        Nivel {{i + 1}}: {{node.name}}
                                    </span>
                                </ng-container>

                                <button mat-icon-button
                                    class="btn-symbio-add-group"
                                    color="primary"
                                    matTooltip="Seleccionar mi grupo"
                                    style="margin-left: 5px;"
                                    (click)="toggleGroupSelectorVisibility(lineage[0])">
                                    <mat-icon>group_add</mat-icon>
                                </button>

                                <button *ngIf="lineage[0].role === 'ambassador'"
                                    class="btn-symbio-add-group"
                                    mat-icon-button
                                    color="primary"
                                    matTooltip="Crear siguiente nivel"
                                    style="margin-left: 5px;"
                                    (click)="openNextLevelGroupDialog(lineage[lineage.length - 1])">
                                    <mat-icon>upgrade</mat-icon>
                                </button>

                                <div [id]="lineage[0].id" hidden style="margin-top: 5px;">
                                    <mat-form-field appearance="fill">
                                        <mat-label>Seleccionar grupo</mat-label>
                                        <!-- <mat-select [(value)]="idGroupSelected" (selectionChange)="onMyGroupChanged(lineage[0])"> -->
                                        <mat-select [(ngModel)]="idGroupSelected" (selectionChange)="onMyGroupChanged(lineage[0])">
                                            <mat-option disabled selected>Elija un grupo</mat-option>
                                            <mat-option value="none">Sin Grupo</mat-option>
                                            <mat-option *ngFor="let g of groups" [value]="g.id">{{g.name}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <button mat-flat-button color="accent"
                                        style="margin-left: 5px;background-color: #287987;color: #FFFFFF;"
                                        (click)="openNewParentGroupDialog(lineage[0].id)">
                                        <mat-icon>add</mat-icon>
                                        Crear grupo
                                    </button>

                                    <button mat-button
                                        style="margin-left: 5px;"
                                        (click)="toggleGroupSelectorVisibility(lineage[0])">
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <mat-menu #groupMenu="matMenu">
            <ng-template matMenuContent let-node="node">
                <button mat-menu-item (click)="openIdeaDetailSidenav(node)">Ver idea</button>
                <button
                    mat-menu-item
                    [matMenuTriggerFor]="groupsSubMenu"
                    [matMenuTriggerData]="{node: node}">
                    Asignar grupo
                </button>
                <button
                    mat-menu-item
                    (click)="openChangeNodeNameDialog(node.id)">
                    Cambiar nombre
                </button>
                <button
                    mat-menu-item
                    (click)="onNodeDeleted(node.id)">
                    Eliminar
                </button>
            </ng-template>
        </mat-menu>

        <mat-menu #groupsSubMenu="matMenu">
            <ng-template matMenuContent let-node="node">
                <!-- <button mat-menu-item *ngFor="let g of filterGroups(groups, node)" (click)="onParentChanged([node.id, g.id])"></button> -->
                <button mat-menu-item (click)="onParentChanged([node.id, 'none'])">
                    <span>Sin Grupo</span>
                </button>
                <button mat-menu-item *ngFor="let group of filterGroups(groups, node)" (click)="onParentChanged([node.id, group.id])"> <!-- filter because a node cannot be its own parent! -->
                    <span>{{group.name}}</span>
                </button>
            </ng-template>
        </mat-menu>

        <mat-menu #participantMenu="matMenu">
            <ng-template matMenuContent let-p="participant">
                <button mat-menu-item
                    (click)="preOpenIdeaDetailSidenav(p.u_id)">
                    Ver idea
                </button>

                <button *ngIf="participant?.isModerator && p.u_id !== participant?.u_id && !p.isModerator"
                    mat-menu-item
                    (click)="setParticipantIsModerator(p, true)">
                    Asignar como moderador
                </button>

                <button *ngIf="participant?.isModerator && p.u_id !== participant?.u_id && p.isModerator"
                    mat-menu-item
                    (click)="setParticipantIsModerator(p, false)">
                    Quitar rol de moderador
                </button>

                <button *ngIf="participant?.isModerator && p.u_id !== participant?.u_id"
                    mat-menu-item
                    (click)="deleteParticipant(p)">
                    Eliminar participante
                </button>
            </ng-template>
        </mat-menu>

    </mat-sidenav>




    <section fxLayout="row" style="height: 100%;">

        <!--
        MARK: Main area
        -->
        <!-- <div fxFlex="77" fxFlex.lt-md="70" fxLayout="column" class="workspace-container" [style.max-width]="!isVisible ? '100%' : '77%'" [style.width]="!isVisible ? '100%' : '77%'"> -->
        <!-- <div fxLayout="column" class="workspace-container" [style.max-width]="!isVisible ? '100%' : '77%'" [style.width]="!isVisible ? '100%' : '77%'"> -->
        <div fxLayout="column" class="workspace-container" [style.max-width]="'100%'" [style.width]="'100%'">

            <div class="mat-elevation-z3 workspace-header" style="padding: 9px; background-color: white; display: flex;justify-content: space-evenly;">
                <h2 class="font-26 gray-900 bolder centered" style="margin-bottom: 0;">



                    <mat-icon class="teal-color-1 workspace-icon-left" style="color:#287987;"
                            [matTooltip]="symbiocreation?.visibility === 'public' ? 'Pública' : 'Privada'"
                            matTooltipPosition="above">
                            {{symbiocreation?.visibility === 'public' ? 'public' : 'lock'}}
                    </mat-icon>

                    <span class="workspace-name">{{symbiocreation?.name}}</span>

                    <button class="workspace-icon-right"
                        mat-icon-button
                        matTooltip="Ver detalles"
                        matTooltipPosition="above"
                        (click)="openSymbioDetailDialog()">
                        <mat-icon class="gray-600">info</mat-icon>
                    </button>

                    <span *ngIf="participant?.isModerator" style="margin-left: 5px;" class="chip-role moderator">Moderador</span>

                    <button class=""
                        *ngIf="participant || appUser?.role === 'SUPER_ADMIN'"
                        mat-icon-button
                        [matMenuTriggerFor]="mainMenu">
                        <mat-icon class="gray-600">more_vert</mat-icon>
                    </button>

                    <mat-menu class="workspace-options" #mainMenu="matMenu">
                        <button mat-menu-item
                            (click)="leaveSymbiocreation()">
                            <mat-icon class="gray-600">person_remove</mat-icon>
                            Darme de baja
                        </button>
                        <button mat-menu-item
                            (click)="downloadParticipantsData()">
                            <mat-icon class="gray-600">download</mat-icon>
                            Descargar datos de participantes
                        </button>
                        <button mat-menu-item
                            (click)="downloadAllData()">
                            <mat-icon class="gray-600">download</mat-icon>
                            Descargar todos los datos
                        </button>
                    </mat-menu>
                </h2>









                <div *ngIf="!participant" style="display: flex;align-items: center;">
                    <!-- <p class="centered">Participa de esta simbiocreación!</p> -->
                    <div style="text-align: center;">
                        <button #btnParticipate mat-raised-button color="accent" (click)="joinSymbiocreation(btnParticipate)" class="bounce" style="background-color: #287987;color: #FFFFFF;">
                            <span>Participar</span>
                        </button>
                    </div>
                </div>
            </div>

            <!--
            MARK: Grafico Symbio
            -->
            <div fxFlex class="workspace-body">
                <app-graph
                    [data]="symbiocreation?.graph"
                    [participant]="participant"
                    [myAncestries]="myAncestries"
                    [currentStrength]="sliderStrengthValue"
                    [currentDistance]="sliderDistanceValue"
                    [currentOrder]="sliderOrderValue"
                    (parentChanged)="onParentChanged($event)"
                    (nodeChangedName)="openChangeNodeNameDialog($event)"
                    (nodeChangedRole)="onRoleChanged($event)"
                    (nodeDeleted)="onNodeDeleted($event)"
                    (dblClickNewIdea)="createUserNode()"
                    >
                </app-graph>
            </div>
        </div>

        <!--
        MARK: Btn flotantes
        -->

        <button class="float-menu-group btn-new-idea" mat-icon-button color="primary" (click)="showFloatIdeaMenuBtn()" matTooltip="Nueva idea" matTooltipPosition="left">
            <mat-icon style="color: white;">add</mat-icon>
        </button>

        <div class="animated-text" [ngClass]="{'show': showFloatIdeaMenu}">
            ¿Agregar una nueva idea?
            <span class="idea-btn-close" (click)="closeIdeaBtn()"><mat-icon>close</mat-icon></span>
        </div>

        <div class="animated-text-2" [ngClass]="{'show': showFloatIdeaMenu}">
            <div class="idea-body">
                <div class="idea-txt">Se agregará una nueva idea <br> (nodo) al grafo de la simbiocreación</div>
                <div class="idea-btn-group">
                    <button mat-flat-button class="idea-btn-cancel" (click)="closeIdeaBtn()">Cancelar</button>
                    <button mat-flat-button class="idea-btn-confirm" (click)="createNewUserIdea()">Confirmar</button>
                </div>
            </div>
        </div>

        <!-- <button class="float-menu-group btn-ideas" mat-icon-button color="primary" (click)="toggleModalIdeas()" matTooltip="Ideas" matTooltipPosition="left"> -->
        <button class="float-menu-group btn-ideas" mat-icon-button color="primary" (click)="OpenGroupsSidenav(5)" matTooltip="Ideas" matTooltipPosition="left">
            <mat-icon style="color: white;">lightbulb</mat-icon>
        </button>

        <!-- <button class="float-menu-group btn-groups" mat-icon-button color="primary" (click)="toggleModalGroups()" matTooltip="Grupos" matTooltipPosition="left"> -->
        <button class="float-menu-group btn-groups" mat-icon-button color="primary" (click)="showFloatGroupMenuBtn()" matTooltip="Grupos" matTooltipPosition="left">
            <mat-icon style="color: white;">group</mat-icon>
        </button>

        <div class="group-float-menu" [ngClass]="{'show': showFloatGroupMenu}">
            Búsquedas
            <span class="group-btn-close" (click)="closeGroupBtn()"><mat-icon>close</mat-icon></span>
        </div>

        <div class="group-float-menu-2" [ngClass]="{'show': showFloatGroupMenu}">
            <div class="group-body">
                <div class="group-btn-group">
                    <button mat-flat-button class="group-btn-grupos" (click)="OpenGroupsSidenav(1)">Grupos</button>
                    <button mat-flat-button class="group-btn-participantes" (click)="OpenGroupsSidenav(2)">Participantes</button>
                </div>
            </div>
        </div>




        <button class="float-menu-group btn-stats" mat-icon-button color="primary" (click)="showFloatStatMenuBtn()" matTooltip="Stats" matTooltipPosition="left">
            <mat-icon style="color: white;">bar_chart</mat-icon>
        </button>

        <div class="stat-float-menu" [ngClass]="{'show': showFloatStatMenu}">
            Stats de Simbiocreación
            <span class="stat-btn-close" (click)="closeStatBtn()"><mat-icon>close</mat-icon></span>
        </div>

        <div class="stat-float-menu-2" [ngClass]="{'show': showFloatStatMenu}">
            <div class="stat-body">
                <div class="stat-txt">Participantes: <span class="number">{{this.totalUsers}}</span></div>
                <div class="stat-txt">Ideas: <span class="number">{{this.totalIdeas}}</span></div>
                <div class="stat-btn-stat">
                    <button mat-flat-button class="stat-btn-grupos" (click)="OpenGroupsSidenav(3)">Top Usuarios</button>
                    <button mat-flat-button class="stat-btn-participantes" (click)="OpenGroupsSidenav(4)">Tendencias</button>
                </div>
            </div>
        </div>

        <!-- Boton antiguo -->
        <button class="float-menu-group btn-options" mat-icon-button (click)="toggleModalOptions()"  matTooltip="Opciones" matTooltipPosition="left">
            <mat-icon style="color: white;">settings</mat-icon>
        </button>

    </section>

    <!-- Modal lateral de ideas -->
    <div class="modal modal-ideas" *ngIf="isModalIdeasOpen" (click)="closeModalIdeas($event)">
        <div class="modal-content" (click)="stopPropagation($event)">

            <div style="display: flex;width:100%; align-items: center; justify-content: space-between;">
                <div style="font-size: 16px;font-weight: 500;">
                    Mi(s) idea(s)
                </div>
                <button class="" mat-icon-button (click)="closeModalIdeas($event)" title="Cerrar">
                    <mat-icon>close</mat-icon>
                </button>
            </div>


            <!-- Participant control panel -->
            <div *ngIf="participant">
                <div fxLayout="column">
                    <div class="gray-900 bold" style="padding: 5px 10px; margin-right: 15px; width: 120px; text-align: left;">
                        <!-- Mi(s) idea(s) <br /> -->
                        <button mat-button
                            color="primary"
                            (click)="createUserNode()"
                            class="btn-symbio-add-group"
                            style="padding: 0;">
                            <mat-icon>add</mat-icon>
                            Nueva idea
                        </button>
                        <!--<span *ngIf="roleOfLoggedIn === 'ambassador'" class="chip-role small ambassador">Embajador</span>-->
                    </div>

                    <div fxFlex style="padding: 5px 10px 0;">
                        <div *ngFor="let lineage of myAncestries" class="item-ideas">

                            <button *ngIf="!lineage[0].idea"
                                mat-flat-button
                                color="accent"
                                (click)="openMyIdeaEditDialog(lineage[0])"
                                (mouseenter)="onMouseEnterListItem([lineage[0]])"
                                (mouseleave)="onMouseLeaveListItem([lineage[0]])"
                                class="btn-idea-element"
                                >
                                <span class="italicized">(vacío)</span>
                            </button>

                            <button *ngIf="lineage[0].idea"
                                mat-flat-button
                                color="accent"
                                matTooltip="Ver detalle"
                                (click)="openIdeaDetailSidenav(lineage[0])"
                                (mouseenter)="onMouseEnterListItem([lineage[0]])"
                                (mouseleave)="onMouseLeaveListItem([lineage[0]])"
                                class="btn-idea-element"
                                >
                                <mat-icon>open_in_new</mat-icon>
                                <span class="ellipsed" style="display: inline-block; width: 130px;">{{lineage[0].idea?.title}}</span>
                            </button>

                            <ng-container *ngFor="let node of lineage | slice:1; index as i; last as last">
                                <span> &lt; </span>
                                <span class="chip-ancestry">
                                    Nivel {{i + 1}}: {{node.name}}
                                </span>
                            </ng-container>

                            <button mat-icon-button
                                class="btn-symbio-add-group"
                                color="primary"
                                matTooltip="Seleccionar mi grupo"
                                style="margin-left: 5px;"
                                (click)="toggleGroupSelectorVisibility(lineage[0])">
                                <mat-icon>group_add</mat-icon>
                            </button>

                            <button *ngIf="lineage[0].role === 'ambassador'"
                                class="btn-symbio-add-group"
                                mat-icon-button
                                color="primary"
                                matTooltip="Crear siguiente nivel"
                                style="margin-left: 5px;"
                                (click)="openNextLevelGroupDialog(lineage[lineage.length - 1])">
                                <mat-icon>upgrade</mat-icon>
                            </button>

                            <div [id]="lineage[0].id" hidden style="margin-top: 5px;">
                                <mat-form-field appearance="fill">
                                    <mat-label>Seleccionar grupo</mat-label>
                                    <!-- <mat-select [(value)]="idGroupSelected" (selectionChange)="onMyGroupChanged(lineage[0])"> -->
                                    <mat-select [(ngModel)]="idGroupSelected" (selectionChange)="onMyGroupChanged(lineage[0])">
                                        <mat-option disabled selected>Elija un grupo</mat-option>
                                        <mat-option value="none">Sin Grupo</mat-option>
                                        <mat-option *ngFor="let g of groups" [value]="g.id">{{g.name}}</mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <button mat-flat-button color="accent"
                                    style="margin-left: 5px;background-color: #287987;color: #FFFFFF;"
                                    (click)="openNewParentGroupDialog(lineage[0].id)">
                                    <mat-icon>add</mat-icon>
                                    Crear grupo
                                </button>

                                <button mat-button
                                    style="margin-left: 5px;"
                                    (click)="toggleGroupSelectorVisibility(lineage[0])">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




            <!-- <div class="container-title">
                <div style="font-size: 16px;font-weight: 500;">
                    Mi(s) idea(s)
                </div>
                <button class="" mat-icon-button (click)="closeModalIdeas($event)" title="Cerrar">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <div *ngIf="!participant">
                Para gestionar ideas es necesario que sea un participante
            </div>

            <div *ngIf="participant">

                <cdk-accordion class="new-ideas">

                    <cdk-accordion-item
                        *ngFor="let lineage of myAncestries; let index = index;"
                        #accordionItem="cdkAccordionItem"
                        role="button"
                        tabindex="0"
                        [attr.id]="'accordion-header-' + index"
                        [attr.aria-expanded]="accordionItem.expanded"
                        [attr.aria-controls]="'accordion-body-' + index"
                    >

                    <div class="example-accordion-item-header" (click)="accordionItem.toggle()">

                        <button *ngIf="!lineage[0].idea"
                            mat-flat-button
                            color="accent"
                            (click)="openMyIdeaEditDialog(lineage[0])">
                            <span class="italicized">(vacío)</span>
                        </button>

                        <button *ngIf="lineage[0].idea"
                            mat-flat-button
                            color="accent"
                            matTooltip="Ver detalle"
                            (click)="openIdeaDetailSidenav(lineage[0])">
                            <mat-icon>open_in_new</mat-icon>
                            <span class="ellipsed" style="display: inline-block; width: 130px;">{{lineage[0].idea?.title}}</span>
                        </button>

                        <button mat-icon-button
                            color="primary"
                            matTooltip="Seleccionar mi grupo"
                            style="margin-left: 5px;"
                            (click)="toggleGroupSelectorVisibility2(lineage[0])">
                            <mat-icon>group_add</mat-icon>
                        </button>

                    </div>

                    <div
                        class="example-accordion-item-body"
                        role="region"
                        [style.display]="accordionItem.expanded ? '' : 'none'"
                        [attr.id]="'accordion-body-' + index"
                        [attr.aria-labelledby]="'accordion-header-' + index"
                    >

                        <ng-container *ngFor="let node of lineage | slice:1; index as i; last as last">
                            <div [style]="{'padding-left': (i+2) * 10 + 'px', 'display':'flex'}">
                                <span class="chip-ancestry-2">
                                    Nivel {{i + 1}}: {{node.name}}
                                </span>
                                <span *ngIf="last">
                                    <button *ngIf="lineage[0].role === 'ambassador'"
                                        mat-icon-button
                                        color="primary"
                                        matTooltip="Crear siguiente nivel"
                                        style="margin-left: 5px;"
                                        (click)="openNextLevelGroupDialog(lineage[lineage.length - 1])">
                                        <mat-icon>upgrade</mat-icon>
                                    </button>
                                </span>
                            </div>
                        </ng-container>







                    </div>

                    <div [id]="lineage[0].id+'@'" hidden style="margin-top: 5px;">
                        <mat-form-field appearance="fill">
                            <mat-label>Seleccionar grupo</mat-label>
                            <mat-select (selectionChange)="onMyGroupChanged(lineage[0])">
                                <mat-option [value]="-1" disabled>Seleccione un grupo</mat-option>
                                <mat-option *ngFor="let g of groups" [value]="g.id">{{g.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <button mat-flat-button color="accent"
                            style="margin-left: 5px;"
                            (click)="openNewParentGroupDialog2(lineage[0].id)">
                            <mat-icon>add</mat-icon>
                            Crear grupo
                        </button>

                        <button mat-button
                            style="margin-left: 5px;"
                            (click)="toggleGroupSelectorVisibility2(lineage[0])">
                            Cancelar
                        </button>
                    </div>




                    </cdk-accordion-item>

                </cdk-accordion>


            </div> -->

        </div>
    </div>

    <!-- Modal lateral de grupos -->
    <div class="modal modal-grupos" *ngIf="isModalGroupsOpen" (click)="closeModalGroups($event)">
        <div class="modal-content" (click)="stopPropagation($event)">

            <div style="display: flex;width:100%; align-items: center; justify-content: space-between;">
                <div style="font-size: 16px;font-weight: 500;">
                    Grupos
                </div>
                <button class="" mat-icon-button (click)="closeModalGroups($event)" title="Cerrar">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <div>

                <!-- Grupos -->
                <mat-expansion-panel expanded class="mat-elevation-z0">
                    <mat-expansion-panel-header class="accent-bg">
                        <mat-panel-title>
                            Grupos
                        </mat-panel-title>
                        <mat-panel-description>
                            {{groups?.length}}
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <div>
                        <mat-form-field appearance="standard" style="width: 100%;">
                            <mat-icon matPrefix>search</mat-icon>
                            <input matInput placeholder="Buscar grupo..." [(ngModel)]="listFilter2" (keyup.esc)="listFilter2 = ''">
                        </mat-form-field>
                    </div>

                    <mat-list id="groupsSideList">
                        <mat-list-item *ngFor="let g of filteredGroups" class="hoveredList1" (mouseenter)="onMouseEnterListItem([g])" (mouseleave)="onMouseLeaveListItem([g])">
                            <div style="display: inline; width: 205px;" (click)="openIdeaDetailSidenav(g)">
                                <span class="font-13">{{g.name}}</span>
                                <span class="font-13 gray-700" style="margin-left: 6px;">· {{g.children.length}} {{g.children.length === 1 ? 'nodo' : 'nodos'}}</span>
                            </div>

                            <button *ngIf="participant?.isModerator || isAmbassadorOfAnyGroupBelow(g)" mat-icon-button [matMenuTriggerFor]="groupMenu" [matMenuTriggerData]="{node: g}">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                        </mat-list-item>
                    </mat-list>

                    <!-- Mat menu and submenu -->
                    <mat-menu #groupMenu="matMenu">
                        <ng-template matMenuContent let-node="node">
                            <button mat-menu-item (click)="openIdeaDetailSidenav(node)">Ver idea</button>
                            <button
                                mat-menu-item
                                [matMenuTriggerFor]="groupsSubMenu"
                                [matMenuTriggerData]="{node: node}">
                                Asignar grupo
                            </button>
                            <button
                                mat-menu-item
                                (click)="openChangeNodeNameDialog(node.id)">
                                Cambiar nombre
                            </button>
                            <button
                                mat-menu-item
                                (click)="onNodeDeleted(node.id)">
                                Eliminar
                            </button>
                        </ng-template>
                    </mat-menu>

                    <mat-menu #groupsSubMenu="matMenu">
                        <ng-template matMenuContent let-node="node">
                            <button mat-menu-item *ngFor="let g of filterGroups(groups, node)" (click)="onParentChanged([node.id, g.id])">
                                <span>{{g.name}}</span>
                            </button>
                        </ng-template>
                    </mat-menu>

                </mat-expansion-panel>

                <!-- Participantes -->
                <mat-expansion-panel expanded class="mat-elevation-z0">
                    <mat-expansion-panel-header class="accent-bg">
                        <mat-panel-title>
                            Participantes
                        </mat-panel-title>
                        <mat-panel-description>
                            {{symbiocreation?.participants.length}}
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <div>
                        <mat-form-field appearance="standard" style="width: 100%;">
                            <mat-icon matPrefix>search</mat-icon>
                            <input matInput placeholder="Buscar participante..." [(ngModel)]="listFilter1" (keyup.esc)="listFilter1 = ''">
                        </mat-form-field>
                    </div>

                    <mat-list id="participantsSideList">
                        <mat-list-item *ngFor="let p of filteredParticipants" class="hoveredList1" (mouseenter)="onMouseEnterListItem(getNodesByUserId(p.u_id))" (mouseleave)="onMouseLeaveListItem(getNodesByUserId(p.u_id))">
                            <div style="display: inline; width: 205px;" (click)="preOpenIdeaDetailSidenav(p.u_id)">
                                <span *ngIf="p.user.firstName && p.user.lastName" class="font-13 list-element-ellipsed">{{p.user.firstName}} {{p.user.lastName}}</span>
                                <span *ngIf="!(p.user.firstName && p.user.lastName)" class="font-13 list-element-ellipsed">{{p.user.name}}</span>

                                <span *ngIf="p.u_id === participant?.u_id" class="font-13 gray-600" style="margin-left: 5px;">(tú)</span>

                                <br />

                                <span *ngIf="p.isModerator" class="chip-role small moderator">Moderador</span>
                                <!--<span *ngIf="p.role === 'ambassador'" class="chip-role small ambassador">Embajador</span>-->
                            </div>

                            <button mat-icon-button
                                [matMenuTriggerFor]="participantMenu"
                                [matMenuTriggerData]="{participant: p}">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                        </mat-list-item>
                    </mat-list>

                    <!-- Mat menu and submenu -->
                    <mat-menu #participantMenu="matMenu">
                        <ng-template matMenuContent let-p="participant">
                            <button mat-menu-item
                                (click)="preOpenIdeaDetailSidenav(p.u_id)">
                                Ver idea
                            </button>

                            <button *ngIf="participant?.isModerator && p.u_id !== participant?.u_id && !p.isModerator"
                                mat-menu-item
                                (click)="setParticipantIsModerator(p, true)">
                                Asignar como moderador
                            </button>

                            <button *ngIf="participant?.isModerator && p.u_id !== participant?.u_id && p.isModerator"
                                mat-menu-item
                                (click)="setParticipantIsModerator(p, false)">
                                Quitar rol de moderador
                            </button>

                            <button *ngIf="participant?.isModerator && p.u_id !== participant?.u_id"
                                mat-menu-item
                                (click)="deleteParticipant(p)">
                                Eliminar participante
                            </button>
                        </ng-template>
                    </mat-menu>
                </mat-expansion-panel>

            </div>



        </div>
    </div>

    <!-- Modal lateral de opciones -->
    <div class="modal modal-opciones" *ngIf="isModalOptionsOpen" (click)="closeModalOptions($event)">
        <div class="modal-content" (click)="stopPropagation($event)">

            <div style="display: flex;width:100%; align-items: center;">
                <div style="font-size: 16px;font-weight: 500;">
                    Opciones
                </div>
                <button class="" mat-icon-button (click)="closeModalOptions($event)" title="Cerrar">
                    <mat-icon>close</mat-icon>
                </button>
            </div>


            <div class="slider-fuerza" >
                <div>Fuerza</div>
                <div>
                    <input type="range" [(ngModel)]="sliderStrengthValue" min="1" max="2000" (input)="sliderStrengthChange()"/>
                </div>
            </div>

            <div class="slider-distancia" >
                <div>Distancia</div>
                <input type="range" [(ngModel)]="sliderDistanceValue" min="20" max="100" (input)="sliderDistanceChange()"/>
            </div>

            <div class="slider-orden" >
                <div>Orden</div>
                <input type="range" [(ngModel)]="sliderOrderValue" min="1" max="1000" (input)="sliderOrderChange()"/>
            </div>

        </div>
    </div>

</mat-sidenav-container>

